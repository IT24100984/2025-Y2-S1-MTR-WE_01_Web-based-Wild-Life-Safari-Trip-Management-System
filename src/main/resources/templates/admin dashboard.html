<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: url("driver.png") no-repeat center center/cover;
      min-height: 100vh;
      color: #333;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.75);
      z-index: -1;
    }

    /* Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .navbar .back {
      font-size: 20px;
      text-decoration: none;
      color: #333;
    }

    .account-dropdown {
      position: relative;
      display: inline-block;
    }

    .account-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #4CAF50;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      background-color: white;
      min-width: 150px;
      border-radius: 8px;
      box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .dropdown-content a {
      padding: 12px 16px;
      display: block;
      text-decoration: none;
      color: #333;
    }

    .dropdown-content a:hover {
      background: #f1f1f1;
    }

    .account-dropdown:hover .dropdown-content {
      display: block;
    }

    /* Message buttons */
    .navbar-buttons {
      display: flex;
      gap: 10px;
    }

    .message-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .driver-btn {
      background: #2196F3;
      color: white;
    }

    .driver-btn:hover {
      background: #1976D2;
      transform: translateY(-1px);
    }

    .guide-btn {
      background: #4CAF50;
      color: white;
    }

    .guide-btn:hover {
      background: #45a049;
      transform: translateY(-1px);
    }

    .contact-btn {
      background: #FF9800;
      color: white;
    }

    .contact-btn:hover {
      background: #F57C00;
      transform: translateY(-1px);
    }

    /* Page Content */
    .content {
      margin: 20px;
      padding: 10px;
    }

    /* Dashboard heading */
    .dashboard-title {
      width: 90%;
      margin: 0 auto 15px auto;
      font-family: 'Merriweather', serif;
      font-size: 28px;
      font-weight: 700;
      color: #222;
    }

    /* Stats Section */
    .stats-container {
      width: 90%;
      margin: 0 auto 20px auto;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
    }

    .stat-card {
      background: rgba(255,255,255,0.9);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      flex: 1;
      min-width: 300px;
      box-sizing: border-box;
    }

    .stat-card h3 {
      margin-top: 0;
      font-size: 18px;
      color: #222;
      text-align: center;
    }

    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
    }

    /* Table 90% width */
    table {
      width: 90%;
      margin: 0 auto;
      border-collapse: collapse;
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }

    th, td {
      text-align: center;
      padding: 12px;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #4CAF50;
      color: white;
      font-weight: 600;
    }

    tr:hover {
      background: #f9f9f9;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .accept-btn {
      background: #4CAF50;
      color: white;
    }

    .reject-btn {
      background: #f44336;
      color: white;
    }

    .special-btn {
      background: #2196F3;
      color: white;
    }

    /* Popup */
    .popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      z-index: 1000;
      max-width: 400px;
      text-align: center;
    }

    .popup button {
      margin-top: 15px;
      background: #4CAF50;
      color: white;
      padding: 8px 16px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 999;
    }

    /* Message popup styles */
    .message-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      z-index: 1000;
      max-width: 500px;
      width: 90%;
    }

    .message-popup h3 {
      margin: 0 0 20px 0;
      font-family: 'Merriweather', serif;
      font-size: 24px;
      color: #222;
      text-align: center;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      box-sizing: border-box;
      resize: vertical;
    }

    .form-group textarea:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 25px;
    }

    .cancel-btn {
      background: #f44336;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .cancel-btn:hover {
      background: #d32f2f;
      transform: translateY(-1px);
    }

    .submit-btn {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .submit-btn:hover {
      background: #45a049;
      transform: translateY(-1px);
    }

    /* Contact popup styles */
    .contact-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      z-index: 1000;
      max-width: 500px;
      width: 90%;
    }

    .contact-popup h3 {
      margin: 0 0 20px 0;
      font-family: 'Merriweather', serif;
      font-size: 24px;
      color: #222;
      text-align: center;
    }

    .contact-popup .form-group {
      margin-bottom: 20px;
    }

    .contact-popup .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .contact-popup .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      box-sizing: border-box;
    }

    .contact-popup .form-group input:focus {
      outline: none;
      border-color: #FF9800;
      box-shadow: 0 0 5px rgba(255, 152, 0, 0.3);
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <a href="/home" class="back">← Home</a>
    <div class="navbar-buttons">
      <button class="message-btn driver-btn" onclick="showMessagePopup('driver')">Send Message to Driver</button>
      <button class="message-btn guide-btn" onclick="showMessagePopup('guide')">Send Message to Guide</button>
      <button class="message-btn contact-btn" onclick="showContactPopup()">Edit Contact Details</button>
    </div>
    <div class="account-dropdown">
      <div class="account-icon">A</div>
      <div class="dropdown-content">
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </div>
  </div>

  <!-- Page Content -->
  <div class="content">
    <!-- Heading -->
    <h1 class="dashboard-title">Admin Dashboard</h1>

    <!-- Stats Section -->
    <div class="stats-container">
      <div class="stat-card">
        <h3>Trips Per Day</h3>
        <div class="chart-container">
          <canvas id="dailyChart"></canvas>
        </div>
      </div>
      <div class="stat-card">
        <h3>Trips Per Week</h3>
        <div class="chart-container">
          <canvas id="weeklyChart"></canvas>
        </div>
      </div>
      <div class="stat-card">
        <h3>Trips Per Month</h3>
        <div class="chart-container">
          <canvas id="monthlyChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Trips Table -->
    <table id="tripsTable">
      <thead>
        <tr>
          <th>Trip ID</th>
          <th>Trip Name</th>
          <th>Date</th>
          <th>No. of People</th>
          <th>Driver ID</th>
          <th>Guide ID</th>
          <th>Special Instructions</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tripsTableBody">
        <!-- Tours will be loaded dynamically -->
      </tbody>
    </table>

    <!-- Reviews Table -->
    <h2 style="text-align: center; margin: 40px 0 20px 0; font-family: 'Merriweather', serif; color: #222;">Pending Reviews</h2>
    <table id="reviewsTable">
      <thead>
        <tr>
          <th>Review ID</th>
          <th>Name</th>
          <th>Review</th>
          <th>Stars</th>
          <th>Date</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="reviewsTableBody">
        <!-- Reviews will be loaded dynamically -->
      </tbody>
    </table>
  </div>

  <!-- Popup -->
  <div class="overlay" id="overlay"></div>
  <div class="popup" id="popup">
    <p id="popupText"></p>
    <button onclick="closePopup()">Close</button>
  </div>

  <!-- Message Popup -->
  <div class="overlay" id="messageOverlay" style="display: none;"></div>
  <div class="message-popup" id="messagePopup" style="display: none;">
    <h3 id="messageTitle">Send Message</h3>
    <form id="messageForm">
      <div class="form-group">
        <label for="messageText">Message:</label>
        <textarea id="messageText" rows="4" required placeholder="Enter your message..."></textarea>
      </div>
      <div class="form-actions">
        <button type="button" onclick="closeMessagePopup()" class="cancel-btn">Cancel</button>
        <button type="submit" class="submit-btn">Send Message</button>
      </div>
    </form>
  </div>

  <!-- Contact Details Popup -->
  <div class="overlay" id="contactOverlay" style="display: none;"></div>
  <div class="contact-popup" id="contactPopup" style="display: none;">
    <h3>Edit Contact Details</h3>
    <form id="contactForm">
      <div class="form-group">
        <label for="contactAddress">Address:</label>
        <input type="text" id="contactAddress" required placeholder="Enter address...">
      </div>
      <div class="form-group">
        <label for="contactPhone">Phone Number:</label>
        <input type="text" id="contactPhone" required placeholder="Enter phone number...">
      </div>
      <div class="form-group">
        <label for="contactEmail">Email:</label>
        <input type="email" id="contactEmail" required placeholder="Enter email...">
      </div>
      <div class="form-actions">
        <button type="button" onclick="closeContactPopup()" class="cancel-btn">Cancel</button>
        <button type="submit" class="submit-btn">Update Contact Details</button>
      </div>
    </form>
  </div>

  <script>
    // Load dashboard data on page load
    window.onload = function() {
      loadDashboardData();
      loadChartData();
      loadPendingReviews();
    };

    // Load dashboard data
    async function loadDashboardData() {
      try {
        const response = await fetch('/api/admin/dashboard-data');
        const data = await response.json();
        
        // Update stats (if you want to display them)
        console.log('Dashboard data loaded:', data);
        
        // Filter out rejected tours
        const filteredTours = data.tours.filter(tour => tour.status !== 'REJECTED');
        
        // Load tours table
        loadToursTable(filteredTours);
      } catch (error) {
        console.error('Error loading dashboard data:', error);
      }
    }

    // Load tours table
    function loadToursTable(tours) {
      const tbody = document.getElementById('tripsTableBody');
      tbody.innerHTML = '';
      
      tours.forEach(tour => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${tour.id}</td>
          <td>${tour.tourName}</td>
          <td>${new Date(tour.tourDate).toLocaleDateString()}</td>
          <td>${tour.numberOfPeople}</td>
          <td>${tour.assignedDriverId || 'Not Assigned'}</td>
          <td>${tour.assignedGuideId || 'Not Assigned'}</td>
          <td><button class="special-btn" onclick="showPopup('${tour.specialInstructions || 'No special instructions'}')">View</button></td>
          <td><span class="status-${tour.status.toLowerCase()}">${tour.status}</span></td>
          <td>
            ${tour.status === 'PENDING' && tour.assignedDriverId && tour.assignedGuideId ? `
              <button class="accept-btn" onclick="acceptTrip(${tour.id})">Accept</button>
              <button class="reject-btn" onclick="rejectTrip(${tour.id})">Reject</button>
            ` : tour.status === 'PENDING' ? `
              <span style="color:orange;font-weight:bold;">Waiting for Assignment</span>
            ` : `
              <span style="color:green;font-weight:bold;">${tour.status}</span>
            `}
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load chart data
    async function loadChartData() {
      try {
        const response = await fetch('/api/admin/chart-data');
        const data = await response.json();
        
        // Update charts with real data
        updateCharts(data);
      } catch (error) {
        console.error('Error loading chart data:', error);
      }
    }

    // Update charts with real data
    function updateCharts(data) {
      // Update daily chart
      if (window.dailyChart) {
        window.dailyChart.data.labels = data.dailyLabels;
        window.dailyChart.data.datasets[0].data = data.dailyData;
        window.dailyChart.update();
      }
      
      // Update weekly chart
      if (window.weeklyChart) {
        window.weeklyChart.data.labels = data.weeklyLabels;
        window.weeklyChart.data.datasets[0].data = data.weeklyData;
        window.weeklyChart.update();
      }
      
      // Update monthly chart
      if (window.monthlyChart) {
        window.monthlyChart.data.labels = data.monthlyLabels;
        window.monthlyChart.data.datasets[0].data = data.monthlyData;
        window.monthlyChart.update();
      }
    }

    // Popup functions
    function showPopup(text) {
      document.getElementById("popupText").innerText = text;
      document.getElementById("popup").style.display = "block";
      document.getElementById("overlay").style.display = "block";
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    function acceptTrip(tourId) {
      // Update tour status to CONFIRMED
      updateTourStatus(tourId, 'CONFIRMED');
    }

    function rejectTrip(tourId) {
      // Update tour status to REJECTED
      updateTourStatus(tourId, 'REJECTED');
    }

    async function updateTourStatus(tourId, status) {
      try {
        const response = await fetch(`/api/tours/${tourId}/status`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ status: status })
        });
        
        if (response.ok) {
          if (status === 'REJECTED') {
            // Remove the tour row from the table immediately
            const rows = document.querySelectorAll('#tripsTableBody tr');
            rows.forEach(row => {
              const firstCell = row.querySelector('td:first-child');
              if (firstCell && firstCell.textContent === tourId.toString()) {
                row.remove();
              }
            });
          } else {
            // Reload the table for other status changes
            loadDashboardData();
          }
        } else {
          alert('Failed to update tour status');
        }
      } catch (error) {
        console.error('Error updating tour status:', error);
        alert('Error updating tour status');
      }
    }

    function logout() {
      // Clear all storage
      sessionStorage.clear();
      localStorage.clear();
      
      // Redirect to Spring Security logout endpoint
      window.location.href = '/logout';
    }

    // Message functionality
    let currentRecipient = '';

    function showMessagePopup(recipient) {
      currentRecipient = recipient;
      const title = document.getElementById('messageTitle');
      const messageText = document.getElementById('messageText');
      
      title.textContent = `Send Message to ${recipient.charAt(0).toUpperCase() + recipient.slice(1)}`;
      messageText.value = '';
      
      document.getElementById('messageOverlay').style.display = 'block';
      document.getElementById('messagePopup').style.display = 'block';
      
      // Focus on textarea
      setTimeout(() => {
        messageText.focus();
      }, 100);
    }

    function closeMessagePopup() {
      document.getElementById('messageOverlay').style.display = 'none';
      document.getElementById('messagePopup').style.display = 'none';
      currentRecipient = '';
    }

    // Handle message form submission
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('messageForm').addEventListener('submit', function(e) {
        e.preventDefault();
        sendMessage();
      });
      
      // Handle contact form submission
      document.getElementById('contactForm').addEventListener('submit', function(e) {
        e.preventDefault();
        updateContactDetails();
      });
    });

    async function sendMessage() {
      try {
        const messageText = document.getElementById('messageText').value.trim();
        
        if (messageText === '') {
          alert('Please enter a message');
          return;
        }

        const messageData = {
          message: messageText,
          to: currentRecipient
        };

        const response = await fetch('/api/notices', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(messageData)
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            alert(`Message sent to ${currentRecipient} successfully!`);
            closeMessagePopup();
          } else {
            alert('Failed to send message: ' + result.message);
          }
        } else {
          alert('Failed to send message');
        }
      } catch (error) {
        console.error('Error sending message:', error);
        alert('Error sending message');
      }
    }

    // Contact popup functions
    function showContactPopup() {
      // Load current contact details
      loadContactDetails();
      
      document.getElementById('contactOverlay').style.display = 'block';
      document.getElementById('contactPopup').style.display = 'block';
      
      // Focus on first input
      setTimeout(() => {
        document.getElementById('contactAddress').focus();
      }, 100);
    }

    function closeContactPopup() {
      document.getElementById('contactOverlay').style.display = 'none';
      document.getElementById('contactPopup').style.display = 'none';
    }

    async function loadContactDetails() {
      try {
        const response = await fetch('/api/contact-details');
        const data = await response.json();
        
        document.getElementById('contactAddress').value = data.address || '';
        document.getElementById('contactPhone').value = data.phone || '';
        document.getElementById('contactEmail').value = data.email || '';
      } catch (error) {
        console.error('Error loading contact details:', error);
        // Set default values if API fails
        document.getElementById('contactAddress').value = '123 Jungle Lane, Wildlands';
        document.getElementById('contactPhone').value = '+94 123 456 789';
        document.getElementById('contactEmail').value = 'info@wildlifesafari.com';
      }
    }

    async function updateContactDetails() {
      try {
        const contactData = {
          address: document.getElementById('contactAddress').value.trim(),
          phone: document.getElementById('contactPhone').value.trim(),
          email: document.getElementById('contactEmail').value.trim()
        };

        if (!contactData.address || !contactData.phone || !contactData.email) {
          alert('Please fill in all fields');
          return;
        }

        const response = await fetch('/api/contact-details', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(contactData)
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            alert('Contact details updated successfully!');
            closeContactPopup();
          } else {
            alert('Failed to update contact details: ' + result.message);
          }
        } else {
          alert('Failed to update contact details');
        }
      } catch (error) {
        console.error('Error updating contact details:', error);
        alert('Error updating contact details');
      }
    }

    // Load pending reviews
    async function loadPendingReviews() {
      try {
        const response = await fetch('/api/reviews/admin/pending');
        const reviews = await response.json();
        
        loadReviewsTable(reviews);
      } catch (error) {
        console.error('Error loading pending reviews:', error);
      }
    }

    // Load reviews table
    function loadReviewsTable(reviews) {
      const tbody = document.getElementById('reviewsTableBody');
      tbody.innerHTML = '';
      
      reviews.forEach(review => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${review.id}</td>
          <td>${review.name}</td>
          <td style="max-width: 200px; word-wrap: break-word;">${review.review}</td>
          <td>${generateStars(review.stars)}</td>
          <td>${new Date(review.createdAt).toLocaleDateString()}</td>
          <td><span class="status-${review.status.toLowerCase()}">${review.status}</span></td>
          <td>
            <button class="accept-btn" onclick="approveReview(${review.id})">Approve</button>
            <button class="reject-btn" onclick="rejectReview(${review.id})">Reject</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Generate stars display
    function generateStars(rating) {
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
          stars += '<span style="color: #ffd700;">★</span>';
        } else {
          stars += '<span style="color: #ddd;">★</span>';
        }
      }
      return stars;
    }

    // Approve review
    async function approveReview(reviewId) {
      await updateReviewStatus(reviewId, 'APPROVED');
    }

    // Reject review
    async function rejectReview(reviewId) {
      await updateReviewStatus(reviewId, 'REJECTED');
    }

    // Update review status
    async function updateReviewStatus(reviewId, status) {
      try {
        const response = await fetch(`/api/reviews/${reviewId}/status`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ status: status })
        });
        
        if (response.ok) {
          // Reload the reviews table
          loadPendingReviews();
        } else {
          alert('Failed to update review status');
        }
      } catch (error) {
        console.error('Error updating review status:', error);
        alert('Error updating review status');
      }
    }

    // Chart initialization
    document.addEventListener('DOMContentLoaded', function() {
      // Daily trips chart
      const dailyCtx = document.getElementById('dailyChart').getContext('2d');
      window.dailyChart = new Chart(dailyCtx, {
        type: 'bar',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Trips',
            data: [12, 19, 15, 17, 22, 28, 25],
            backgroundColor: 'rgba(76, 175, 80, 0.7)',
            borderColor: 'rgba(76, 175, 80, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Trips'
              }
            }
          }
        }
      });

      // Weekly trips chart
      const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
      window.weeklyChart = new Chart(weeklyCtx, {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [{
            label: 'Trips',
            data: [85, 92, 78, 105],
            backgroundColor: 'rgba(33, 150, 243, 0.2)',
            borderColor: 'rgba(33, 150, 243, 1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Trips'
              }
            }
          }
        }
      });

      // Monthly trips chart
      const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
      window.monthlyChart = new Chart(monthlyCtx, {
        type: 'bar',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          datasets: [{
            label: 'Trips',
            data: [320, 350, 380, 420, 450, 480, 510, 490, 460, 430, 400, 370],
            backgroundColor: 'rgba(156, 39, 176, 0.7)',
            borderColor: 'rgba(156, 39, 176, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Trips'
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>